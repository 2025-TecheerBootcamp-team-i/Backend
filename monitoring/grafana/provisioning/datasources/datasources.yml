# Grafana 데이터소스 자동 프로비저닝
# Grafana 시작 시 자동으로 데이터소스가 등록됩니다

apiVersion: 1

datasources:
  # Prometheus - 메트릭 데이터소스
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true  # 기본 데이터소스로 설정
    editable: false  # UI에서 수정 불가 (코드로만 관리)
    jsonData:
      timeInterval: "15s"  # 기본 스크래핑 간격과 동일
      httpMethod: POST

  # Loki - 로그 데이터소스
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    editable: false
    jsonData:
      maxLines: 1000  # 한 번에 표시할 최대 로그 라인
      derivedFields:
        # 로그에서 trace_id 추출 (추후 트레이싱 연동 시 사용)
        - name: TraceID
          matcherRegex: "trace_id=(\\w+)"
          url: ""
