AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: "\uC774\uBBF8\uC9C0 \uB9AC\uC0AC\uC774\uC9D5 Lambda \uD568\uC218 (\uAE30\
  \uC874 S3 \uBC84\uD0B7 \uC0AC\uC6A9) \uAE30\uC874 S3 \uBC84\uD0B7\uC5D0 \uC774\uBBF8\
  \uC9C0 \uC5C5\uB85C\uB4DC \uC2DC \uC790\uB3D9\uC73C\uB85C \uB9AC\uC0AC\uC774\uC9D5\
  \uD569\uB2C8\uB2E4.\n"
Globals:
  Function:
    Timeout: 30
    MemorySize: 512
    Runtime: python3.11
    Architectures:
    - x86_64
Parameters:
  ExistingBucketName:
    Type: String
    Description: "\uAE30\uC874 S3 \uBC84\uD0B7 \uC774\uB984 (\uC774\uBBF8 \uC874\uC7AC\
      \uD558\uB294 \uBC84\uD0B7)"
Resources:
  ImageResizerFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: music-image-resizer
      Description: "\uC544\uD2F0\uC2A4\uD2B8/\uC568\uBC94/\uD2B8\uB799 \uC774\uBBF8\
        \uC9C0 \uB9AC\uC0AC\uC774\uC9D5 (\uAE30\uC874 \uBC84\uD0B7 \uC0AC\uC6A9)"
      CodeUri: ImageResizerFunction
      Handler: app.lambda_handler
      Environment:
        Variables:
          BUCKET_NAME:
            Ref: ExistingBucketName
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - s3:GetObject
          - s3:PutObject
          - s3:DeleteObject
          Resource:
            Fn::Sub: arn:aws:s3:::${ExistingBucketName}/*
        - Effect: Allow
          Action:
          - s3:ListBucket
          Resource:
            Fn::Sub: arn:aws:s3:::${ExistingBucketName}
    Metadata:
      SamResourceId: ImageResizerFunction
Outputs:
  ImageResizerFunction:
    Description: "Lambda \uD568\uC218 ARN"
    Value:
      Fn::GetAtt:
      - ImageResizerFunction
      - Arn
  ImageResizerFunctionName:
    Description: "Lambda \uD568\uC218 \uC774\uB984"
    Value:
      Ref: ImageResizerFunction
  SetupInstructions:
    Description: "S3 \uD2B8\uB9AC\uAC70 \uC124\uC815 \uC548\uB0B4"
    Value: "\uAE30\uC874 \uBC84\uD0B7\uC744 \uC0AC\uC6A9\uD558\uBBC0\uB85C S3 \uD2B8\
      \uB9AC\uAC70\uB97C AWS Console\uC5D0\uC11C \uC218\uB3D9\uC73C\uB85C \uC124\uC815\
      \uD574\uC57C \uD569\uB2C8\uB2E4.\n\n1. AWS Console > S3 > \uBC84\uD0B7 \uC120\
      \uD0DD\n2. Properties > Event notifications > Create event notification\n3.\
      \ \uB2E4\uC74C \uACBD\uB85C\uC5D0 \uB300\uD574 \uAC01\uAC01 \uC774\uBCA4\uD2B8\
      \ \uC0DD\uC131:\n   - media/images/artists/original/\n   - media/images/albums/original/\n\
      \   - media/images/tracks/original/\n4. Event types: s3:ObjectCreated:*\n5.\
      \ Destination: Lambda function > music-image-resizer\n"
